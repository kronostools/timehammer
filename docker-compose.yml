version: '3'
services:
  db:
    image: postgres:12.2-alpine
    container_name: timehammer-db
    environment:
      POSTGRES_USER: timehammer
      POSTGRES_DB: timehammer
      POSTGRES_PASSWORD: ${TIMEHAMMER_DB_PASSWORD}
      TZ: Etc/UTC
    volumes:
      - dbdata:/var/lib/postgresql/data
    networks:
      - timehammer
    restart: unless-stopped
  reverseproxy:
    image: linuxserver/letsencrypt:1.3.0-ls109
    container_name: timehammer-reverseproxy
    environment:
      PUID: 1001 # timehammer
      PGID: 1001 # timehammer
      TZ: Etc/UTC
      URL: kronostools.com
      SUBDOMAINS: timehammer,
      VALIDATION: http
      EMAIL: admin@kronostools.com
      DHLEVEL: 2048
      ONLY_SUBDOMAINS: "true"
      STAGING: "false"
    volumes:
      - ./wksp/reverseproxy/config:/config
    ports:
      - 80:80
      - 443:443
    cap_add:
      - NET_ADMIN
    networks:
      - timehammer
    restart: unless-stopped
  timehammer:
    image: maven:3.6.3-jdk-11-slim
    container_name: timehammer
    env_file:
      - .env
    volumes:
      - ./wksp/timehammer:/root/wksp/timehammer
      - ${HOME}/.m2/repository:/root/.m2/repository
    working_dir: /root/wksp/timehammer
    command: mvn -Dquarkus.profile=remotedemo quarkus:dev
    networks:
      - timehammer
    restart: unless-stopped
  timehammernativebuild:
    image: quay.io/quarkus/centos-quarkus-maven:20.0.0-java8
    container_name: timehammernativebuild
    volumes:
      - ./wksp/timehammer:/project/timehammer
    working_dir: /project/timehammer
    command: /bin/bash
    stdin_open: true
    tty: true
    networks:
      - timehammer
  timehammernative:
    build:
      context: ./wksp/timehammer
      dockerfile: ./src/main/docker/Dockerfile.native.tiny
    image: timehammer-native:1.0.0
    container_name: timehammernative
    networks:
      - timehammer

volumes:
  dbdata:

networks:
  timehammer: